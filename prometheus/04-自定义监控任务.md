# 自定义监控任务


## 开启配置
- 除去配置`ServiceMonitor`资源外，还有些是需要定义的资源，如监控`MinIO`，在`kube-prometheus-stack`的`values.yaml`文件中配置`prometheus.prometheusSpec.additionalScrapeConfigsSecret`即可。
  ```yaml
  prometheus:
    prometheusSpec:
      additionalScrapeConfigsSecret:
        enabled: true
        name: additional-scrape-configs-secret
        key: additional-scrape-configs.yaml
  ```


## 监控minio
  - https://min.io/docs/minio/linux/operations/monitoring/metrics-and-alerts.html#metrics-and-alerts
  - `minio`服务配置文件`/etc/default/minio`中增加`MINIO_PROMETHEUS_AUTH_TYPE="public"`，禁用认证，然后重启服务。
    ```
    By default, MinIO requires authentication to scrape the metrics endpoints. To generate the needed bearer tokens, 
    use "mc admin prometheus generate". You can also disable metrics endpoint authentication by setting "MINIO_PROMETHEUS_AUTH_TYPE" to "public".
    ```
  - 配置文件是`argocd-manifests/monitoring/prometheusAdditionalScrapeConfigs/cvmMinio.libsonnet`。


## 监控mysql
